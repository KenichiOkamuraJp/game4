# Vue.js ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³RPG Pythonç‰ˆ - å®Œå…¨ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰é›†

# ========================================
# ã‚¹ãƒ†ãƒƒãƒ— 1: å‰æã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# ========================================

# Python 3.11 ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
winget install Python.Python.3.11

# Node.js ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
winget install OpenJS.NodeJS

# AWS CLI ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
winget install Amazon.AWSCLI

# Git ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
winget install Git.Git

# PowerShell å®Ÿè¡Œãƒãƒªã‚·ãƒ¼è¨­å®š
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
python --version
node --version
npm --version
aws --version
git --version

# ========================================
# ã‚¹ãƒ†ãƒƒãƒ— 2: AWS èªè¨¼è¨­å®š
# ========================================

# AWS èªè¨¼æƒ…å ±è¨­å®š
aws configure
# å…¥åŠ›é …ç›®:
# - AWS Access Key ID: [ã‚ãªãŸã®ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼]
# - AWS Secret Access Key: [ã‚ãªãŸã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼]
# - Default region name: ap-northeast-1
# - Default output format: json

# èªè¨¼ç¢ºèª
aws sts get-caller-identity

# ========================================
# ã‚¹ãƒ†ãƒƒãƒ— 3: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
# ========================================

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
mkdir vue-dungeon-rpg-python
cd vue-dungeon-rpg-python

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆ
mkdir lambda\characters
mkdir lambda\saves
mkdir scripts

# ========================================
# ã‚¹ãƒ†ãƒƒãƒ— 4: ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
# ========================================

# ã“ã®æ®µéšã§ã€ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„:
# 
# ğŸ“ lambda/characters/
# - requirements.txt
# - create.py
# - list.py
# - update.py
# - delete.py
#
# ğŸ“ lambda/saves/
# - requirements.txt
# - create.py
# - get.py
# - update.py
# - delete.py
#
# ğŸ“ scripts/
# - cloudformation.yaml (Pythonç‰ˆ)
# - deploy-lambda.ps1 (Pythonç‰ˆ)
# - install-dependencies.ps1 (Pythonç‰ˆ)
# - setup.ps1 (æ—¢å­˜)
# - cleanup.ps1 (æ—¢å­˜)
#
# ğŸ“ ãƒ«ãƒ¼ãƒˆ/
# - package.json
# - vite.config.js
# - index.html (æ—¢å­˜ã®ã‚²ãƒ¼ãƒ ãƒ•ã‚¡ã‚¤ãƒ«)
# - README.md (Pythonç‰ˆ)

# ========================================
# ã‚¹ãƒ†ãƒƒãƒ— 5: ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# ========================================

# Python/Node.js ä¾å­˜é–¢ä¿‚ã®ç¢ºèªãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
.\scripts\install-dependencies.ps1

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# ========================================
# ã‚¹ãƒ†ãƒƒãƒ— 6: AWS ã‚¤ãƒ³ãƒ•ãƒ©ã®ãƒ‡ãƒ—ãƒ­ã‚¤
# ========================================

# CloudFormation ã‚¹ã‚¿ãƒƒã‚¯ã®ãƒ‡ãƒ—ãƒ­ã‚¤
.\scripts\setup.ps1 -ProjectName "my-dungeon-rpg" -AdminEmail "your-email@example.com"

# å®Ÿè¡Œå†…å®¹:
# - DynamoDB ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
# - Cognito User Pool/Identity Pool ä½œæˆ
# - Lambda é–¢æ•°ä½œæˆï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰
# - API Gateway ä½œæˆ
# - IAM ãƒ­ãƒ¼ãƒ«ä½œæˆ
# - .env ãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•ç”Ÿæˆ

# ========================================
# ã‚¹ãƒ†ãƒƒãƒ— 7: Python Lambda é–¢æ•°ã®ãƒ‡ãƒ—ãƒ­ã‚¤
# ========================================

# Lambda é–¢æ•°ã« Python ã‚³ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
.\scripts\deploy-lambda.ps1 -ProjectName "my-dungeon-rpg"

# å®Ÿè¡Œå†…å®¹:
# - å„ Lambda é–¢æ•°ã¸ã® Python ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤
# - boto3 ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# - ZIP ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆãƒ»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
# - é–¢æ•°æ›´æ–°ã®å®Œäº†å¾…æ©Ÿ

# ========================================
# ã‚¹ãƒ†ãƒƒãƒ— 8: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èµ·å‹•ãƒ»å‹•ä½œç¢ºèª
# ========================================

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run dev

# ãƒ–ãƒ©ã‚¦ã‚¶ã§ä»¥ä¸‹ã«ã‚¢ã‚¯ã‚»ã‚¹:
# http://localhost:5173

# å‹•ä½œç¢ºèª:
# 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²/ãƒ­ã‚°ã‚¤ãƒ³
# 2. ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä½œæˆ
# 3. ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³æ¢ç´¢
# 4. æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ 
# 5. ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½

# ========================================
# é–‹ç™ºæ™‚ã®ã‚³ãƒãƒ³ãƒ‰
# ========================================

# Lambda é–¢æ•°ã®ã¿å†ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆPython ã‚³ãƒ¼ãƒ‰ä¿®æ­£å¾Œï¼‰
.\scripts\deploy-lambda.ps1

# ã‚¤ãƒ³ãƒ•ãƒ©ã®ã¿å†ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆCloudFormationä¿®æ­£å¾Œï¼‰
.\scripts\setup.ps1

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰
npm run build

# ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
npm run preview

# ========================================
# ãƒ‡ãƒãƒƒã‚°ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
# ========================================

# Lambda é–¢æ•°ä¸€è¦§ç¢ºèª
aws lambda list-functions --query "Functions[?starts_with(FunctionName, 'my-dungeon-rpg')].{Name:FunctionName,Runtime:Runtime}"

# CloudWatch ãƒ­ã‚°ç¢ºèª
aws logs describe-log-groups --log-group-name-prefix /aws/lambda/my-dungeon-rpg

# ç‰¹å®šé–¢æ•°ã®ãƒ­ã‚°å‡ºåŠ›
aws logs tail /aws/lambda/my-dungeon-rpg-characters-create --follow

# CloudFormation ã‚¹ã‚¿ãƒƒã‚¯çŠ¶æ…‹ç¢ºèª
aws cloudformation describe-stacks --stack-name my-dungeon-rpg-stack

# DynamoDB ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª
aws dynamodb list-tables --query "TableNames[?starts_with(@, 'my-dungeon-rpg')]"

# ========================================
# ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆå…¨ãƒªã‚½ãƒ¼ã‚¹å‰Šé™¤ï¼‰
# ========================================

# å…¨ AWS ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤
.\scripts\cleanup.ps1 -ProjectName "my-dungeon-rpg"

# âš ï¸ è­¦å‘Š: å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã™ï¼

# ========================================
# æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®ã‚³ãƒãƒ³ãƒ‰
# ========================================

# æœ¬ç•ªç”¨ãƒ“ãƒ«ãƒ‰
npm run build

# æœ¬ç•ªç”¨ Lambda ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæœ€é©åŒ–ï¼‰
.\scripts\deploy-lambda.ps1 -ProjectName "prod-dungeon-rpg"

# CloudWatch ã‚¢ãƒ©ãƒ¼ãƒ è¨­å®šä¾‹
aws cloudwatch put-metric-alarm --alarm-name "Lambda-Error-Rate" --alarm-description "Lambda function error rate" --metric-name Errors --namespace AWS/Lambda --statistic Sum --period 300 --threshold 10 --comparison-operator GreaterThanThreshold

# ========================================
# ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰é›†
# ========================================

# Python ä»®æƒ³ç’°å¢ƒä½œæˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
python -m venv venv
venv\Scripts\activate

# pip ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆç”¨ï¼‰
cd lambda\characters
pip install -r requirements.txt

# JSON æ•´å½¢è¡¨ç¤º
aws cloudformation describe-stacks --stack-name my-dungeon-rpg-stack --query "Stacks[0].Outputs" | python -m json.tool

# ç‰¹å®šãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒªã‚½ãƒ¼ã‚¹ç¢ºèª
aws lambda list-functions --region ap-northeast-1 --query "Functions[?contains(FunctionName, 'dungeon')]"